<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song JSON Maker</title>
    <!-- 1. Load the ID3 metadata reading library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #222; color: #fff; margin: 0; padding: 24px; }
        .container { max-width: 800px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .box { background: #333; padding: 24px; border-radius: 12px; }
        h1 { margin-top: 0; }
        h2 { margin-top: 0; border-bottom: 1px solid #555; padding-bottom: 10px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #aaa; }
        /* Added small note style */
        label span { font-weight: 400; font-style: italic; color: #888; }
        input[type="text"] { width: 100%; padding: 10px; box-sizing: border-box; border-radius: 6px; border: 1px solid #555; background: #282828; color: #fff; font-size: 14px; margin-bottom: 16px; }
        button { background: #1DB954; color: #fff; border: 0; padding: 12px 20px; font-size: 16px; font-weight: 700; border-radius: 30px; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #1ed760; }
        #drop-zone { border: 2px dashed #555; border-radius: 12px; padding: 40px; text-align: center; color: #888; margin-bottom: 20px; }
        #drop-zone.dragover { border-color: #1DB954; background: #444; }
        #output-json { width: 100%; height: 300px; box-sizing: border-box; background: #282828; color: #fff; border: 1px solid #555; border-radius: 6px; font-family: monospace; font-size: 14px; padding: 16px; }
        #song-list { list-style: none; padding: 0; }
        #song-list li { background: #444; padding: 10px; border-radius: 6px; margin-bottom: 8px; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="box" id="form-box">
            <h1>Song JSON Maker</h1>
            
            <!-- 2. This is the drag-and-drop zone -->
            <div id="drop-zone">Drag & Drop an MP3 file here to auto-fill Title/Artist</div>
            
            <h2>Song Details</h2>
            <form id="song-form">
                <label for="title">Title</label>
                <input type="text" id="title" required>
                
                <label for="artist">Artist</label>
                <input type="text" id="artist" required>
                
                <!-- UPDATED LABEL -->
                <label for="file">MP3 Filename <span>(e.g., song1.mp3)</span><br>
                    <span>This tool assumes you will place the file in your <b>`assets/Music/`</b> folder.</span>
                </label>
                <input type="text" id="file" required>
                
                <!-- UPDATED LABEL -->
                <label for="image">Image Path <span>(e.g., assets/Albums/song1.jpg)</span><br>
                    <span>This path is relative to your main website folder.</span>
                </label>
                <input type="text" id="image" required>
                
                <button type="submit" id="add-song-btn">Add Song</button>
            </form>
        </div>
        
        <div class="box">
            <h2>Current Song List (<span id="song-count">0</span>)</h2>
            <ul id="song-list"></ul>
            
            <h2>Generated JSON</h2>
            <p>Copy this and paste it into your `songs.json` file.</p>
            <textarea id="output-json" readonly></textarea>
        </div>
    </div>

    <script>
        const jsmediatags = window.jsmediatags;
        const songForm = document.getElementById('song-form');
        const dropZone = document.getElementById('drop-zone');
        const titleInput = document.getElementById('title');
        const artistInput = document.getElementById('artist');
        const fileInput = document.getElementById('file');
        const imageInput = document.getElementById('image');
        const songList = document.getElementById('song-list');
        const songCount = document.getElementById('song-count');
        const outputJson = document.getElementById('output-json');
        
        let songs = [];

        // --- 3. Logic to read MP3 metadata ---
        function readMp3Tags(file) {
            jsmediatags.read(file, {
                onSuccess: function(tag) {
                    const tags = tag.tags;
                    console.log(tags);
                    titleInput.value = tags.title || '';
                    artistInput.value = tags.artist || '';
                    fileInput.value = file.name || '';
                    
                    // Guess the image name
                    const nameOnly = file.name.replace('.mp3', '');
                    imageInput.value = `assets/Albums/${nameOnly}.jpg`;
                    
                    dropZone.textContent = `Loaded: ${file.name}`;
                    dropZone.style.borderColor = "#1DB954";
                },
                onError: function(error) {
                    console.log('Error reading metadata:', error);
                    dropZone.textContent = "Could not read metadata. Please fill manually.";
                    dropZone.style.borderColor = "#ff0000";
                    fileInput.value = file.name || '';
                }
            });
        }

        // --- 4. Drag-and-Drop Event Listeners ---
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('audio/')) {
                readMp3Tags(file);
            } else {
                dropZone.textContent = "Please drop an MP3 file.";
            }
        });

        // --- 5. Form submission logic ---
        songForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newSong = {
                id: `local_${Date.now()}`,
                title: titleInput.value,
                artist: artistInput.value,
                file: fileInput.value,
                image: imageInput.value
            };
            
            songs.push(newSong);
            updateUI();
            
            // Clear form for next entry
            songForm.reset();
            dropZone.textContent = "Drag & Drop an MP3 file here to auto-fill Title/Artist";
            dropZone.style.borderColor = "#555";
        });

        // --- 6. Update UI and generate JSON ---
        function updateUI() {
            // Update song list
            songList.innerHTML = '';
            songs.forEach(song => {
                const li = document.createElement('li');
                li.textContent = `${song.title} - ${song.artist}`;
                songList.appendChild(li);
            });
            songCount.textContent = songs.length;
            
            // Generate the final JSON
            const jsonOutput = {
                songs: songs
            };
            outputJson.value = JSON.stringify(jsonOutput, null, 2); // 'null, 2' makes it pretty-print
        }

    </script>
</body>
</html>